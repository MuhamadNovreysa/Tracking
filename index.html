<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HimaBida Trivia Battle</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        body {
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .game-screen {
            display: none;
        }
        .lobby {
            text-align: center;
        }
        input, button {
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 16px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .player-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        .player {
            background: #ecf0f1;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            min-width: 120px;
        }
        .current-player {
            background: #3498db;
            color: white;
        }
        .question-container {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        .option {
            background: white;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #ddd;
        }
        .option:hover {
            border-color: #3498db;
        }
        .option.selected {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        .option.correct {
            background: #2ecc71;
            color: white;
            border-color: #2ecc71;
        }
        .option.incorrect {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }
        .punishment {
            background: #f39c12;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        .scoreboard {
            margin: 20px 0;
        }
        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .timer {
            text-align: center;
            font-size: 24px;
            margin: 10px 0;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HimaBida Trivia Battle</h1>
        
        <div id="lobby" class="lobby">
            <h2>Enter Game Lobby</h2>
            <input type="text" id="playerName" placeholder="Your Name">
            <button id="joinGame">Join Game</button>
            <div id="players" class="player-list"></div>
            <button id="startGame" disabled>Start Game</button>
        </div>
        
        <div id="game" class="game-screen">
            <div class="timer" id="timer">30</div>
            <div class="question-container">
                <h2 id="question">Question will appear here</h2>
                <div class="options" id="options"></div>
            </div>
            <div class="punishment" id="punishment">
                <h3>PUNISHMENT!</h3>
                <p id="punishmentText">You must record an IG story singing a children's song!</p>
            </div>
            <div class="scoreboard" id="scoreboard"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD0w6J5QJ5QJ5QJ5QJ5QJ5QJ5QJ5QJ5QJ5Q",
            authDomain: "himabida-trivia-battle.firebaseapp.com",
            databaseURL: "https://himabida-trivia-battle-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "himabida-trivia-battle",
            storageBucket: "himabida-trivia-battle.appspot.com",
            messagingSenderId: "1234567890",
            appId: "1:1234567890:web:abcdef1234567890"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Game variables
        let playerId;
        let playerName;
        let gameId = "himabida-game-1"; // Single game room for demo
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let timerInterval;

        // DOM elements
        const lobbyScreen = document.getElementById('lobby');
        const gameScreen = document.getElementById('game');
        const playerNameInput = document.getElementById('playerName');
        const joinGameBtn = document.getElementById('joinGame');
        const startGameBtn = document.getElementById('startGame');
        const playersList = document.getElementById('players');
        const questionElement = document.getElementById('question');
        const optionsElement = document.getElementById('options');
        const timerElement = document.getElementById('timer');
        const punishmentElement = document.getElementById('punishment');
        const punishmentTextElement = document.getElementById('punishmentText');
        const scoreboardElement = document.getElementById('scoreboard');

        // Questions database
        const questions = [
            {
                question: "Apa platform e-commerce terbesar di Indonesia?",
                options: ["Tokopedia", "Shopee", "Bukalapak", "Lazada"],
                answer: 1,
                punishment: "Record IG story menyanyikan jingle iklan e-commerce favoritmu!"
            },
            {
                question: "Apa kepanjangan dari SEO?",
                options: ["Search Engine Optimization", "Social Engagement Organization", "Systematic Evaluation Operation", "Search Experience Optimization"],
                answer: 0,
                punishment: "Buat 3 pose foto seperti influencer SEO!"
            },
            {
                question: "Berapa persen rata-rata conversion rate e-commerce di Indonesia?",
                options: ["0.5-1%", "2-3%", "5-7%", "10-12%"],
                answer: 1,
                punishment: "Tirukan suara robot seperti voice assistant selama 15 detik!"
            },
            {
                question: "Apa nama metode pembayaran digital terpopuler di Indonesia?",
                options: ["OVO", "DANA", "GoPay", "ShopeePay"],
                answer: 2,
                punishment: "Buat dance pendek ala iklan e-wallet dan upload ke IG story!"
            },
            {
                question: "Berapa jumlah pengguna internet di Indonesia pada 2023?",
                options: ["100 juta", "150 juta", "175 juta", "200 juta"],
                answer: 2,
                punishment: "Post tweet 'Aku baru tahu ada 175 juta pengguna internet di Indonesia! #HimaBidaTrivia'"
            }
        ];

        // Punishments database
        const punishments = [
            "Record IG story menyanyikan lagu anak-anak!",
            "Upload foto dengan filter IG paling norak!",
            "Buat TikTok dance pendek tentang digital marketing!",
            "Post tweet tentang pelajaran dari game ini!",
            "Ganti profil WhatsApp dengan screenshot score terendah!"
        ];

        // Join game
        joinGameBtn.addEventListener('click', () => {
            playerName = playerNameInput.value.trim();
            if (playerName) {
                playerId = generateId();
                joinGame(playerId, playerName);
            } else {
                alert("Please enter your name");
            }
        });

        // Start game
        startGameBtn.addEventListener('click', () => {
            database.ref(`games/${gameId}`).update({
                status: "playing",
                currentQuestion: 0,
                scores: {}
            });
        });

        // Generate random ID
        function generateId() {
            return 'player-' + Math.random().toString(36).substr(2, 9);
        }

        // Join game room
        function joinGame(id, name) {
            const playerRef = database.ref(`games/${gameId}/players/${id}`);
            
            playerRef.set({
                name: name,
                score: 0,
                ready: false
            });

            // Listen for player updates
            database.ref(`games/${gameId}/players`).on('value', (snapshot) => {
                updatePlayersList(snapshot.val());
            });

            // Listen for game state changes
            database.ref(`games/${gameId}`).on('value', (snapshot) => {
                const game = snapshot.val();
                if (game && game.status === "playing") {
                    startGame();
                    updateGameState(game);
                }
            });

            lobbyScreen.style.display = "none";
            gameScreen.style.display = "block";
        }

        // Update players list
        function updatePlayersList(players) {
            playersList.innerHTML = "";
            let playerCount = 0;
            
            for (const id in players) {
                playerCount++;
                const player = players[id];
                const playerElement = document.createElement('div');
                playerElement.className = 'player';
                playerElement.textContent = player.name;
                if (id === playerId) {
                    playerElement.classList.add('current-player');
                }
                playersList.appendChild(playerElement);
            }

            // Enable start button if there are at least 2 players
            if (playerCount >= 2) {
                startGameBtn.disabled = false;
            }
        }

        // Start the game
        function startGame() {
            lobbyScreen.style.display = "none";
            gameScreen.style.display = "block";
            showQuestion(0);
        }

        // Update game state
        function updateGameState(game) {
            if (game.currentQuestion !== currentQuestionIndex) {
                currentQuestionIndex = game.currentQuestion;
                showQuestion(currentQuestionIndex);
            }

            if (game.scores) {
                updateScoreboard(game.scores);
            }
        }

        // Show question
        function showQuestion(index) {
            if (index >= questions.length) {
                endGame();
                return;
            }

            const question = questions[index];
            questionElement.textContent = question.question;
            optionsElement.innerHTML = "";

            // Reset timer
            clearInterval(timerInterval);
            let timeLeft = 30;
            timerElement.textContent = timeLeft;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleAnswer(-1); // Timeout
                }
            }, 1000);

            // Create options
            question.options.forEach((option, i) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                optionElement.dataset.index = i;
                
                optionElement.addEventListener('click', () => {
                    if (!selectedAnswer) {
                        selectedAnswer = i;
                        document.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        optionElement.classList.add('selected');
                        handleAnswer(i);
                    }
                });
                
                optionsElement.appendChild(optionElement);
            });

            // Reset selection
            selectedAnswer = null;
            punishmentElement.style.display = "none";
        }

        // Handle answer
        function handleAnswer(selectedIndex) {
            clearInterval(timerInterval);
            
            const question = questions[currentQuestionIndex];
            const isCorrect = selectedIndex === question.answer;
            
            // Highlight correct and incorrect answers
            document.querySelectorAll('.option').forEach((opt, i) => {
                if (i === question.answer) {
                    opt.classList.add('correct');
                } else if (i === selectedIndex && !isCorrect) {
                    opt.classList.add('incorrect');
                }
                opt.style.pointerEvents = "none";
            });

            // Update score
            const scoreUpdate = isCorrect ? 10 : (selectedIndex === -1 ? 0 : -5);
            database.ref(`games/${gameId}/players/${playerId}`).update({
                score: firebase.database.ServerValue.increment(scoreUpdate)
            });

            // Show punishment if wrong
            if (!isCorrect && selectedIndex !== -1) {
                punishmentTextElement.textContent = question.punishment || 
                    punishments[Math.floor(Math.random() * punishments.length)];
                punishmentElement.style.display = "block";
            }

            // Move to next question after delay
            setTimeout(() => {
                database.ref(`games/${gameId}`).update({
                    currentQuestion: currentQuestionIndex + 1
                });
            }, 5000);
        }

        // Update scoreboard
        function updateScoreboard(scores) {
            scoreboardElement.innerHTML = "<h2>Scoreboard</h2>";
            
            // Convert scores object to array and sort
            const playersArray = [];
            for (const id in scores) {
                playersArray.push({
                    id,
                    name: scores[id].name,
                    score: scores[id].score
                });
            }
            
            playersArray.sort((a, b) => b.score - a.score);
            
            // Display scores
            playersArray.forEach(player => {
                const scoreItem = document.createElement('div');
                scoreItem.className = 'score-item';
                scoreItem.innerHTML = `
                    <span>${player.name}</span>
                    <span>${player.score} pts</span>
                `;
                if (player.id === playerId) {
                    scoreItem.style.fontWeight = "bold";
                }
                scoreboardElement.appendChild(scoreItem);
            });
        }

        // End game
        function endGame() {
            questionElement.textContent = "Game Over!";
            optionsElement.innerHTML = "";
            timerElement.textContent = "";
            
            // Show final scores
            database.ref(`games/${gameId}/players`).once('value').then(snapshot => {
                updateScoreboard(snapshot.val());
            });
        }
    </script>
</body>
</html>
